import{G as e,H as t,J as n,K as r,Q as i,U as a,V as o,W as s,Y as c,Z as l,at as u,b as d,et as f,it as p,n as m,o as h,ot as g,q as _,rt as v,tt as y,x as b,y as x}from"./index-DONMULiq.js";import{t as S}from"./format-BwLcG6eA.js";var C={class:`databases`},w={class:`card-header`},T={class:`dialog-footer`},E=m(_({__name:`DatabasesView`,setup(m){let g=v(!1),_=v(!1),E=v(!1),D=v(!1),O=v([]),k=x(),A=v(),j=v({name:``,description:``,isPublic:!1,id:``}),M={name:[{required:!0,message:`请输入数据库名称`,trigger:`blur`},{min:2,max:50,message:`长度在 2-50 个字符之间`,trigger:`blur`}],description:[{max:200,message:`描述不能超过200个字符`,trigger:`blur`}]},N=v(`创建数据库`),P=e=>[`owner`,`admin`].includes(e.role||``),F=e=>e.role===`owner`,I=async()=>{g.value=!0;try{let e=await h.list();e.success&&e.data&&(O.value=e.data.databases||[])}catch{b.error(`加载数据库列表失败`)}finally{g.value=!1}},L=()=>{D.value=!1,N.value=`创建数据库`,j.value={name:``,description:``,isPublic:!1,id:``},E.value=!0},R=e=>{D.value=!0,N.value=`编辑数据库`,j.value={name:e.name,description:e.description||``,isPublic:!1,id:e.id},E.value=!0},z=e=>{k.push(`/databases/${e.id}`)},B=async e=>{try{await d.confirm(`确定要删除数据库 "${e.name}" 吗？相关数据将被清空。`,`警告`,{type:`warning`,confirmButtonText:`确定`,cancelButtonText:`取消`}),b.success(`删除成功`),await I()}catch(e){e!==`cancel`&&b.error(`删除失败`)}},V=async()=>{if(A.value)try{if(!await A.value.validate())return;_.value=!0,D.value?b.success(`更新成功`):(await h.create({name:j.value.name,description:j.value.description,isPublic:j.value.isPublic})).success&&b.success(`创建成功`),E.value=!1,await I()}catch{b.error(D.value?`更新失败`:`创建失败`)}finally{_.value=!1}},H=()=>{A.value&&A.value.resetFields()};return n(()=>{I()}),(n,d)=>{let m=l(`el-button`),h=l(`el-empty`),v=l(`el-table-column`),b=l(`el-tag`),x=l(`el-table`),D=l(`el-card`),k=l(`el-input`),I=l(`el-form-item`),U=l(`el-switch`),W=l(`el-form`),G=l(`el-dialog`),K=i(`loading`);return c(),s(`div`,C,[r(D,{class:`box-card`},{header:f(()=>[o(`div`,w,[d[6]||=o(`span`,null,`数据库管理`,-1),r(m,{type:`primary`,onClick:L},{default:f(()=>[...d[5]||=[e(`新建数据库`,-1)]]),_:1})])]),default:f(()=>[O.value.length===0?(c(),t(h,{key:0,description:`暂无数据库，请创建您的第一个数据库`},{default:f(()=>[r(m,{type:`primary`,onClick:L},{default:f(()=>[...d[7]||=[e(`创建数据库`,-1)]]),_:1})]),_:1})):y((c(),t(x,{key:1,data:O.value,style:{width:`100%`}},{default:f(()=>[r(v,{prop:`name`,label:`数据库名称`,"min-width":`180`}),r(v,{prop:`type`,label:`类型`,width:`120`},{default:f(({row:t})=>[r(b,{type:`info`},{default:f(()=>[e(u(t.type||`PostgreSQL`),1)]),_:2},1024)]),_:1}),r(v,{prop:`table_count`,label:`表数量`,width:`100`,align:`center`}),r(v,{prop:`created_at`,label:`创建时间`,width:`180`},{default:f(({row:t})=>[e(u(p(S)(t.created_at)),1)]),_:1}),r(v,{label:`操作`,width:`200`,fixed:`right`},{default:f(({row:n})=>[r(m,{size:`small`,onClick:e=>z(n)},{default:f(()=>[...d[8]||=[e(`表结构`,-1)]]),_:1},8,[`onClick`]),P(n)?(c(),t(m,{key:0,size:`small`,type:`primary`,onClick:e=>R(n)},{default:f(()=>[...d[9]||=[e(`编辑`,-1)]]),_:1},8,[`onClick`])):a(``,!0),F(n)?(c(),t(m,{key:1,size:`small`,type:`danger`,onClick:e=>B(n)},{default:f(()=>[...d[10]||=[e(`删除`,-1)]]),_:1},8,[`onClick`])):a(``,!0)]),_:1})]),_:1},8,[`data`])),[[K,g.value]])]),_:1}),r(G,{modelValue:E.value,"onUpdate:modelValue":d[4]||=e=>E.value=e,title:N.value,width:`500px`,onClose:H},{footer:f(()=>[o(`span`,T,[r(m,{onClick:d[3]||=e=>E.value=!1},{default:f(()=>[...d[11]||=[e(`取消`,-1)]]),_:1}),r(m,{type:`primary`,onClick:V,loading:_.value},{default:f(()=>[...d[12]||=[e(` 确定 `,-1)]]),_:1},8,[`loading`])])]),default:f(()=>[r(W,{ref_key:`formRef`,ref:A,model:j.value,rules:M,"label-width":`100px`,loading:_.value},{default:f(()=>[r(I,{label:`数据库名称`,prop:`name`},{default:f(()=>[r(k,{modelValue:j.value.name,"onUpdate:modelValue":d[0]||=e=>j.value.name=e,placeholder:`请输入数据库名称`},null,8,[`modelValue`])]),_:1}),r(I,{label:`描述`,prop:`description`},{default:f(()=>[r(k,{modelValue:j.value.description,"onUpdate:modelValue":d[1]||=e=>j.value.description=e,type:`textarea`,rows:3,placeholder:`请输入数据库描述（可选）`},null,8,[`modelValue`])]),_:1}),r(I,{label:`公开`,prop:`isPublic`},{default:f(()=>[r(U,{modelValue:j.value.isPublic,"onUpdate:modelValue":d[2]||=e=>j.value.isPublic=e,"active-text":`允许其他用户访问`},null,8,[`modelValue`])]),_:1})]),_:1},8,[`model`,`loading`])]),_:1},8,[`modelValue`,`title`])])}}}),[[`__scopeId`,`data-v-dab657f1`]]);export{E as default};