import{F as e,G as t,H as n,J as r,K as i,U as a,V as o,W as s,Y as c,Z as l,_ as u,b as d,et as f,it as p,n as m,ot as h,q as g,r as _,rt as v,x as y,y as b}from"./index-DONMULiq.js";var x={class:`profile`},S={class:`avatar-section`},C={class:`avatar-upload`},w={class:`upload-actions`},T={class:`security-section`},E={class:`dialog-footer`},D=m(g({__name:`ProfileView`,setup(m){let h=_(),g=b(),D=v(!1),O=v(!1),k=v(!1),A=v({username:``,email:``,phone:``,bio:``,avatar:``}),j=v({currentPassword:``,newPassword:``,confirmPassword:``}),M=async()=>{try{let e=await u.getProfile();if(e.success&&e.data){let t=e.data;A.value={username:t.username||``,email:t.email||``,phone:t.phone||``,bio:t.bio||``,avatar:t.avatar||``}}}catch{y.error(`加载个人资料失败`)}},N=async()=>{D.value=!0;try{let e=await u.updateProfile({username:A.value.username,email:A.value.email,phone:A.value.phone,bio:A.value.bio,avatar:A.value.avatar});if(!e.success)throw Error(e.message||`更新失败`);y.success(`个人资料更新成功`),await h.fetchProfile(),await M()}catch(e){y.error(e instanceof Error?e.message:`更新失败`)}finally{D.value=!1}},P=e=>{let t=new FileReader;t.onload=e=>{e.target?.result&&(A.value.avatar=e.target.result,y.success(`头像已更新`))},e.raw&&t.readAsDataURL(e.raw)},F=()=>{A.value.avatar=``,y.success(`头像已移除`)},I=async()=>{if(j.value.newPassword!==j.value.confirmPassword){y.error(`两次输入的密码不一致`);return}O.value=!0;try{let e=await u.changePassword({current_password:j.value.currentPassword,new_password:j.value.newPassword});if(!e.success)throw Error(e.message||`密码修改失败`);y.success(`密码修改成功`),k.value=!1,j.value={currentPassword:``,newPassword:``,confirmPassword:``}}catch(e){y.error(e instanceof Error?e.message:`密码修改失败`)}finally{O.value=!1}},L=()=>{d.confirm(`确定要删除账户吗？此操作不可恢复，所有相关数据将被清空。`,`警告`,{type:`warning`,confirmButtonText:`确定删除`,cancelButtonText:`取消`}).then(()=>{R()}).catch(()=>{})},R=async()=>{try{let{value:e}=await d.prompt(`请输入当前密码以确认删除账户`,`二次确认`,{inputType:`password`,confirmButtonText:`删除`,cancelButtonText:`取消`,inputPlaceholder:`当前密码`,closeOnClickModal:!1}),t=await u.deleteAccount({password:e});if(!t.success)throw Error(t.message||`删除账户失败`);y.success(`账户已删除`),h.clearAuth(),await g.replace(`/login`)}catch(e){e!==`cancel`&&y.error(e instanceof Error?e.message:`删除账户失败`)}};return r(()=>{M()}),(r,u)=>{let d=l(`el-input`),m=l(`el-form-item`),h=l(`el-button`),g=l(`el-form`),_=l(`el-col`),v=l(`el-avatar`),y=l(`el-upload`),b=l(`el-row`),M=l(`el-card`),R=l(`el-dialog`);return c(),s(`div`,x,[i(M,{class:`box-card`},{header:f(()=>[...u[10]||=[o(`div`,{class:`card-header`},[o(`span`,null,`个人资料`)],-1)]]),default:f(()=>[i(b,{gutter:20},{default:f(()=>[i(_,{span:12},{default:f(()=>[i(g,{model:A.value,"label-width":`100px`,ref:`profileFormRef`},{default:f(()=>[i(m,{label:`用户名`,prop:`username`},{default:f(()=>[i(d,{modelValue:A.value.username,"onUpdate:modelValue":u[0]||=e=>A.value.username=e,placeholder:`请输入用户名`},null,8,[`modelValue`])]),_:1}),i(m,{label:`邮箱`,prop:`email`},{default:f(()=>[i(d,{modelValue:A.value.email,"onUpdate:modelValue":u[1]||=e=>A.value.email=e,placeholder:`请输入邮箱`},null,8,[`modelValue`])]),_:1}),i(m,{label:`手机号`,prop:`phone`},{default:f(()=>[i(d,{modelValue:A.value.phone,"onUpdate:modelValue":u[2]||=e=>A.value.phone=e,placeholder:`请输入手机号`},null,8,[`modelValue`])]),_:1}),i(m,{label:`简介`,prop:`bio`},{default:f(()=>[i(d,{modelValue:A.value.bio,"onUpdate:modelValue":u[3]||=e=>A.value.bio=e,type:`textarea`,rows:3,placeholder:`个人简介`},null,8,[`modelValue`])]),_:1}),i(m,null,{default:f(()=>[i(h,{type:`primary`,onClick:N,loading:D.value},{default:f(()=>[...u[11]||=[t(` 更新资料 `,-1)]]),_:1},8,[`loading`])]),_:1})]),_:1},8,[`model`])]),_:1}),i(_,{span:12},{default:f(()=>[o(`div`,S,[u[14]||=o(`h4`,null,`头像`,-1),o(`div`,C,[i(v,{size:100,src:A.value.avatar,class:`avatar`},{default:f(()=>[A.value.avatar?a(``,!0):(c(),n(p(e),{key:0}))]),_:1},8,[`src`]),o(`div`,w,[i(y,{action:`#`,"auto-upload":!1,"show-file-list":!1,"on-change":P,limit:1},{default:f(()=>[i(h,{size:`small`,type:`primary`},{default:f(()=>[...u[12]||=[t(`更换头像`,-1)]]),_:1})]),_:1}),A.value.avatar?(c(),n(h,{key:0,size:`small`,onClick:F},{default:f(()=>[...u[13]||=[t(` 移除头像 `,-1)]]),_:1})):a(``,!0)])])]),o(`div`,T,[u[17]||=o(`h4`,null,`安全设置`,-1),i(h,{type:`warning`,onClick:u[4]||=e=>k.value=!0},{default:f(()=>[...u[15]||=[t(` 修改密码 `,-1)]]),_:1}),i(h,{type:`danger`,onClick:L},{default:f(()=>[...u[16]||=[t(` 删除账户 `,-1)]]),_:1})])]),_:1})]),_:1})]),_:1}),i(R,{modelValue:k.value,"onUpdate:modelValue":u[9]||=e=>k.value=e,title:`修改密码`,width:`400px`},{footer:f(()=>[o(`span`,E,[i(h,{onClick:u[8]||=e=>k.value=!1},{default:f(()=>[...u[18]||=[t(`取消`,-1)]]),_:1}),i(h,{type:`primary`,onClick:I,loading:O.value},{default:f(()=>[...u[19]||=[t(` 确认修改 `,-1)]]),_:1},8,[`loading`])])]),default:f(()=>[i(g,{model:j.value,"label-width":`100px`,ref:`passwordFormRef`},{default:f(()=>[i(m,{label:`当前密码`,prop:`currentPassword`},{default:f(()=>[i(d,{modelValue:j.value.currentPassword,"onUpdate:modelValue":u[5]||=e=>j.value.currentPassword=e,type:`password`,placeholder:`请输入当前密码`,"show-password":``},null,8,[`modelValue`])]),_:1}),i(m,{label:`新密码`,prop:`newPassword`},{default:f(()=>[i(d,{modelValue:j.value.newPassword,"onUpdate:modelValue":u[6]||=e=>j.value.newPassword=e,type:`password`,placeholder:`请输入新密码`,"show-password":``},null,8,[`modelValue`])]),_:1}),i(m,{label:`确认密码`,prop:`confirmPassword`},{default:f(()=>[i(d,{modelValue:j.value.confirmPassword,"onUpdate:modelValue":u[7]||=e=>j.value.confirmPassword=e,type:`password`,placeholder:`请再次输入新密码`,"show-password":``},null,8,[`modelValue`])]),_:1})]),_:1},8,[`model`])]),_:1},8,[`modelValue`])])}}}),[[`__scopeId`,`data-v-6a6eac72`]]);export{D as default};