import{B as e,G as t,H as n,J as r,K as i,Q as a,S as o,U as s,V as c,W as l,Y as u,Z as d,at as f,b as p,et as m,g as h,it as g,n as _,o as v,ot as y,q as b,rt as x,tt as S,v as C,x as w,y as T}from"./index-DONMULiq.js";import{t as E}from"./format-BwLcG6eA.js";var D={class:`tables`},O={class:`card-header`},k={class:`header-left`},A={class:`database-name`},j={class:`dialog-footer`},M=_(b({__name:`TableView`,setup(_){let y=C(),b=T(),M=y.params.id,N=x(``),P=x(``),F=x(!1),I=x(!1),L=x(!1),R=x([]),z=x(),B=x({name:``,description:``}),V={name:[{required:!0,message:`请输入表名称`,trigger:`blur`},{min:2,max:100,message:`长度在 2-100 个字符之间`,trigger:`blur`}],description:[{max:500,message:`描述不能超过500个字符`,trigger:`blur`}]},H=x(`创建表`),U=e(()=>[`owner`,`admin`,`editor`].includes(P.value)),W=e(()=>[`owner`,`admin`].includes(P.value)),G=()=>{b.push(`/databases`)},K=async()=>{F.value=!0;try{let e=await v.getTables(M);e.success&&e.data&&(R.value=e.data.tables||[])}catch{w.error(`加载表列表失败`)}finally{F.value=!1}},q=async()=>{try{let e=await v.getDetail(M);e.success&&e.data&&(N.value=e.data.name||``,P.value=e.data.role||`viewer`)}catch(e){console.error(`Failed to load database info:`,e)}},J=()=>{H.value=`创建表`,B.value={name:``,description:``},L.value=!0},Y=e=>{b.push(`/tables/${e.id}/fields`)},X=e=>{b.push(`/tables/${e.id}/records`)},Z=async e=>{try{await p.confirm(`确定要删除表 "${e.name}" 吗？相关数据将被清空。`,`警告`,{type:`warning`,confirmButtonText:`确定`,cancelButtonText:`取消`}),(await h.delete(e.id)).success&&(w.success(`删除成功`),await K())}catch(e){e!==`cancel`&&w.error(`删除失败`)}},Q=async()=>{if(z.value)try{if(!await z.value.validate())return;I.value=!0,(await h.create({database_id:M,name:B.value.name,description:B.value.description})).success&&(w.success(`创建成功`),L.value=!1,await K())}catch{w.error(`创建失败`)}finally{I.value=!1}},$=()=>{z.value&&z.value.resetFields()};return r(()=>{q(),K()}),(e,r)=>{let p=d(`el-icon`),h=d(`el-button`),_=d(`el-empty`),v=d(`el-table-column`),y=d(`el-table`),b=d(`el-card`),x=d(`el-input`),C=d(`el-form-item`),w=d(`el-form`),T=d(`el-dialog`),M=a(`loading`);return u(),l(`div`,D,[i(b,{class:`box-card`},{header:m(()=>[c(`div`,O,[c(`div`,k,[i(h,{link:``,onClick:G},{default:m(()=>[i(p,null,{default:m(()=>[i(g(o))]),_:1}),r[4]||=t(` 返回数据库列表 `,-1)]),_:1}),c(`span`,A,f(N.value),1)]),U.value?(u(),n(h,{key:0,type:`primary`,onClick:J},{default:m(()=>[...r[5]||=[t(`新建表`,-1)]]),_:1})):s(``,!0)])]),default:m(()=>[R.value.length===0?(u(),n(_,{key:0,description:`暂无表，请创建您的第一个表`},{default:m(()=>[U.value?(u(),n(h,{key:0,type:`primary`,onClick:J},{default:m(()=>[...r[6]||=[t(`创建表`,-1)]]),_:1})):s(``,!0)]),_:1})):S((u(),n(y,{key:1,data:R.value,style:{width:`100%`}},{default:m(()=>[i(v,{prop:`name`,label:`表名称`,"min-width":`200`}),i(v,{prop:`description`,label:`描述`,"min-width":`250`,"show-overflow-tooltip":``}),i(v,{prop:`created_at`,label:`创建时间`,width:`180`},{default:m(({row:e})=>[t(f(g(E)(e.created_at)),1)]),_:1}),i(v,{label:`操作`,width:`240`,fixed:`right`},{default:m(({row:e})=>[i(h,{size:`small`,onClick:t=>Y(e)},{default:m(()=>[...r[7]||=[t(`字段管理`,-1)]]),_:1},8,[`onClick`]),i(h,{size:`small`,onClick:t=>X(e)},{default:m(()=>[...r[8]||=[t(`数据记录`,-1)]]),_:1},8,[`onClick`]),W.value?(u(),n(h,{key:0,size:`small`,type:`danger`,onClick:t=>Z(e)},{default:m(()=>[...r[9]||=[t(`删除`,-1)]]),_:1},8,[`onClick`])):s(``,!0)]),_:1})]),_:1},8,[`data`])),[[M,F.value]])]),_:1}),i(T,{modelValue:L.value,"onUpdate:modelValue":r[3]||=e=>L.value=e,title:H.value,width:`600px`,onClose:$},{footer:m(()=>[c(`span`,j,[i(h,{onClick:r[2]||=e=>L.value=!1},{default:m(()=>[...r[10]||=[t(`取消`,-1)]]),_:1}),i(h,{type:`primary`,onClick:Q,loading:I.value},{default:m(()=>[...r[11]||=[t(` 确定 `,-1)]]),_:1},8,[`loading`])])]),default:m(()=>[i(w,{ref_key:`formRef`,ref:z,model:B.value,rules:V,"label-width":`100px`,loading:I.value},{default:m(()=>[i(C,{label:`表名称`,prop:`name`},{default:m(()=>[i(x,{modelValue:B.value.name,"onUpdate:modelValue":r[0]||=e=>B.value.name=e,placeholder:`请输入表名称`},null,8,[`modelValue`])]),_:1}),i(C,{label:`描述`,prop:`description`},{default:m(()=>[i(x,{modelValue:B.value.description,"onUpdate:modelValue":r[1]||=e=>B.value.description=e,type:`textarea`,rows:4,placeholder:`请输入表描述（可选）`},null,8,[`modelValue`])]),_:1})]),_:1},8,[`model`,`loading`])]),_:1},8,[`modelValue`,`title`])])}}}),[[`__scopeId`,`data-v-1c4cf36e`]]);export{M as default};